<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.css" />
	<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.js"></script>
	
	<script type="text/javascript">
		$("#register").click(function(){
			var data = $("#registration-form").serialize();
			$.post('./php/etsyLogin.php', data, 'json')
				.done(function(responseData) {
					var response = $.parseJSON(responseData);
					var url = response.response
					window.location(url);
				})
				.fail(function(data){
					$("#errormsg").text("I'm sorry, we cannot register you in at this time. Please try again later. Thanks!");
				});
		});
		$("#new_username").blur(function(){
			console.log("blur");
			//php call to see if that user is in the database
			$.get('./php/verifyUserAvailable.php', { name: '"' + this.val() + '"'})
				.done(function(responseData){
					var result = $.paresJSON(responseData);
					result = result.response;
					if(result == "available"){
						$("#step2").show();
					}else{
						$("#errormsg").text("Oops! Somebody has already taken that username. ");	
					}
				})
				.fail(function(){
					$("#errormsg").text("I'm sorry, we cannot register you in at this time. Please try again later. Thanks!");
				});
		});
	</script>
	<link rel="stylesheet" href="./main.css" />
</head>
<body>
	<div data-role="page" id="registration">
		<div data-role="header" data-position="fixed">
			<h1>Etsy&trade; Seller's Tools</h1>
		</div>
		<div data-role="content">
			<h1>Registration</h1>
			<p>First off, let's create a login for this application. </p>
			<form id="registration-form">
				<input type="text" name="new_username" id="new_username" placeholder="Username"/>
				<input type="password" name="new_password" id="new_password" placeholder="Password"/>
				<div id="errormsg"></div>

				<div id="step2">
					<p>Alright! That email address is not already registered!</p>
					<p>Next, in order for the Etsy&trade; Seller's Tools app to work, you need to authorize us to access your Etsy information. Click the button
					below to visit the Etsy site and authorize Etsy&trade; Seller's Tools. Etsy will automatically send you back to us.</p>
					<input type="button" id="register" value="Authorize this app!"></input>
				</div>
			</form>
		</div>
		<div data-role="footer" data-id="siteFooter" data-position="fixed">
			 <span class="disclosure">The term 'Etsy' is a trademark of Etsy, Inc. This application uses the Etsy API but is not endorsed or certified by Etsy, Inc.</span>
		</div>
	</div>
</body>
</html>